<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Form Builder - Test Version</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        const FIELD_TYPES = [
            "short_answer",
            "paragraph",
            "email",
            "phone",
            "number",
            "url",
            "file_upload",
            "image_upload",
            "date",
            "time",
            "datetime",
            "multiple_choice",
            "rating",
            "slider",
            "lat_long",
            "province",
            "factory"
        ];

        const THAI_PROVINCES = [
            "‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£", "‡∏Å‡∏£‡∏∞‡∏ö‡∏µ‡πà", "‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏ö‡∏∏‡∏£‡∏µ", "‡∏Å‡∏≤‡∏¨‡∏™‡∏¥‡∏ô‡∏ò‡∏∏‡πå", "‡∏Å‡∏≥‡πÅ‡∏û‡∏á‡πÄ‡∏û‡∏ä‡∏£", "‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô", "‡∏à‡∏±‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ", "‡∏â‡∏∞‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏ó‡∏£‡∏≤",
            "‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ", "‡∏ä‡∏±‡∏¢‡∏ô‡∏≤‡∏ó", "‡∏ä‡∏±‡∏¢‡∏†‡∏π‡∏°‡∏¥", "‡∏ä‡∏∏‡∏°‡∏û‡∏£", "‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏¢", "‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà", "‡∏ï‡∏£‡∏±‡∏á", "‡∏ï‡∏£‡∏≤‡∏î", "‡∏ï‡∏≤‡∏Å", "‡∏ô‡∏Ñ‡∏£‡∏ô‡∏≤‡∏¢‡∏Å",
            "‡∏ô‡∏Ñ‡∏£‡∏õ‡∏ê‡∏°", "‡∏ô‡∏Ñ‡∏£‡∏û‡∏ô‡∏°", "‡∏ô‡∏Ñ‡∏£‡∏£‡∏≤‡∏ä‡∏™‡∏µ‡∏°‡∏≤", "‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏ò‡∏£‡∏£‡∏°‡∏£‡∏≤‡∏ä", "‡∏ô‡∏Ñ‡∏£‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå", "‡∏ô‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ", "‡∏ô‡∏£‡∏≤‡∏ò‡∏¥‡∏ß‡∏≤‡∏™", "‡∏ô‡πà‡∏≤‡∏ô",
            "‡∏ö‡∏∂‡∏á‡∏Å‡∏≤‡∏¨", "‡∏ö‡∏∏‡∏£‡∏µ‡∏£‡∏±‡∏°‡∏¢‡πå", "‡∏õ‡∏ó‡∏∏‡∏°‡∏ò‡∏≤‡∏ô‡∏µ", "‡∏õ‡∏£‡∏∞‡∏à‡∏ß‡∏ö‡∏Ñ‡∏µ‡∏£‡∏µ‡∏Ç‡∏±‡∏ô‡∏ò‡πå", "‡∏õ‡∏£‡∏≤‡∏à‡∏µ‡∏ô‡∏ö‡∏∏‡∏£‡∏µ", "‡∏õ‡∏±‡∏ï‡∏ï‡∏≤‡∏ô‡∏µ", "‡∏û‡∏£‡∏∞‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏≠‡∏¢‡∏∏‡∏ò‡∏¢‡∏≤",
            "‡∏û‡∏∞‡πÄ‡∏¢‡∏≤", "‡∏û‡∏±‡∏á‡∏á‡∏≤", "‡∏û‡∏±‡∏ó‡∏•‡∏∏‡∏á", "‡∏û‡∏¥‡∏à‡∏¥‡∏ï‡∏£", "‡∏û‡∏¥‡∏©‡∏ì‡∏∏‡πÇ‡∏•‡∏Å", "‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏∏‡∏£‡∏µ", "‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏π‡∏£‡∏ì‡πå", "‡πÅ‡∏û‡∏£‡πà", "‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï",
            "‡∏°‡∏´‡∏≤‡∏™‡∏≤‡∏£‡∏Ñ‡∏≤‡∏°", "‡∏°‡∏∏‡∏Å‡∏î‡∏≤‡∏´‡∏≤‡∏£", "‡πÅ‡∏°‡πà‡∏Æ‡πà‡∏≠‡∏á‡∏™‡∏≠‡∏ô", "‡∏¢‡∏∞‡∏•‡∏≤", "‡∏¢‡πÇ‡∏™‡∏ò‡∏£", "‡∏£‡πâ‡∏≠‡∏¢‡πÄ‡∏≠‡πá‡∏î", "‡∏£‡∏∞‡∏ô‡∏≠‡∏á", "‡∏£‡∏∞‡∏¢‡∏≠‡∏á", "‡∏£‡∏≤‡∏ä‡∏ö‡∏∏‡∏£‡∏µ",
            "‡∏•‡∏û‡∏ö‡∏∏‡∏£‡∏µ", "‡∏•‡∏≥‡∏õ‡∏≤‡∏á", "‡∏•‡∏≥‡∏û‡∏π‡∏ô", "‡πÄ‡∏•‡∏¢", "‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©", "‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£", "‡∏™‡∏á‡∏Ç‡∏•‡∏≤", "‡∏™‡∏ï‡∏π‡∏•", "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£", "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°",
            "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏≤‡∏Ñ‡∏£", "‡∏™‡∏£‡∏∞‡πÅ‡∏Å‡πâ‡∏ß", "‡∏™‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏µ", "‡∏™‡∏¥‡∏á‡∏´‡πå‡∏ö‡∏∏‡∏£‡∏µ", "‡∏™‡∏∏‡πÇ‡∏Ç‡∏ó‡∏±‡∏¢", "‡∏™‡∏∏‡∏û‡∏£‡∏£‡∏ì‡∏ö‡∏∏‡∏£‡∏µ", "‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ", "‡∏™‡∏∏‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå",
            "‡∏´‡∏ô‡∏≠‡∏á‡∏Ñ‡∏≤‡∏¢", "‡∏´‡∏ô‡∏≠‡∏á‡∏ö‡∏±‡∏ß‡∏•‡∏≥‡∏†‡∏π", "‡∏≠‡πà‡∏≤‡∏á‡∏ó‡∏≠‡∏á", "‡∏≠‡∏∏‡∏î‡∏£‡∏ò‡∏≤‡∏ô‡∏µ", "‡∏≠‡∏∏‡∏ó‡∏±‡∏¢‡∏ò‡∏≤‡∏ô‡∏µ", "‡∏≠‡∏∏‡∏ï‡∏£‡∏≤‡∏î‡∏¥‡∏ï‡∏ñ‡πå", "‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏≤‡∏ä‡∏ò‡∏≤‡∏ô‡∏µ", "‡∏≠‡∏≥‡∏ô‡∏≤‡∏à‡πÄ‡∏à‡∏£‡∏¥‡∏ç"
        ];

        const FACTORY_OPTIONS = [
            "‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏ö‡∏≤‡∏á‡∏õ‡∏∞‡∏≠‡∏¥‡∏ô",
            "‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏¢‡∏≠‡∏á",
            "‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏µ",
            "‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏™‡∏á‡∏Ç‡∏•‡∏≤"
        ];

        const MULTIPLE_CHOICE_DISPLAY_OPTIONS = [
            { value: "radio", label: "Radio Buttons" },
            { value: "buttons", label: "Button Group" },
            { value: "dropdown", label: "Dropdown" }
        ];

        function uid(prefix = "id") {
            return `${prefix}_${Math.random().toString(36).slice(2, 9)}`;
        }

        function FieldPreview({ field }) {
            const [selectedValues, setSelectedValues] = useState([]);

            const handleButtonClick = (value) => {
                if (field.allowMultiple) {
                    setSelectedValues(prev =>
                        prev.includes(value)
                            ? prev.filter(v => v !== value)
                            : [...prev, value]
                    );
                } else {
                    setSelectedValues([value]);
                }
            };

            const renderFieldInput = () => {
                switch (field.type) {
                    case "short_answer":
                        return <input className="w-full border rounded px-3 py-2" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡πâ‡∏ô ‡πÜ" />;

                    case "paragraph":
                        return <textarea className="w-full border rounded px-3 py-2 min-h-[100px]" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß ‡πÜ" />;

                    case "email":
                        return <input type="email" className="w-full border rounded px-3 py-2" placeholder="example@email.com" />;

                    case "phone":
                        return <input type="tel" className="w-full border rounded px-3 py-2" placeholder="0xx-xxx-xxxx" />;

                    case "number":
                        return <input type="number" className="w-full border rounded px-3 py-2" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç" />;

                    case "url":
                        return <input type="url" className="w-full border rounded px-3 py-2" placeholder="https://example.com" />;

                    case "file_upload":
                        return (
                            <div className="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                                <div className="text-gray-500">üìé ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</div>
                                <input type="file" className="hidden" />
                            </div>
                        );

                    case "image_upload":
                        return (
                            <div className="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                                <div className="text-gray-500">üñºÔ∏è ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≤‡∏Å‡∏£‡∏π‡∏õ‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</div>
                                <input type="file" accept="image/*" className="hidden" />
                            </div>
                        );

                    case "date":
                        return <input type="date" className="border rounded px-3 py-2" />;

                    case "time":
                        return <input type="time" className="border rounded px-3 py-2" />;

                    case "datetime":
                        return <input type="datetime-local" className="border rounded px-3 py-2" />;

                    case "multiple_choice":
                        if (!field.options || field.options.length === 0) {
                            return <div className="text-gray-400 italic">‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</div>;
                        }

                        if (field.displayStyle === "dropdown") {
                            return (
                                <select className="w-full border rounded px-3 py-2">
                                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
                                    {field.options.map((opt, idx) => (
                                        <option key={idx} value={opt}>{opt}</option>
                                    ))}
                                </select>
                            );
                        }

                        if (field.displayStyle === "buttons") {
                            return (
                                <div className="flex flex-wrap gap-2">
                                    {field.options.map((opt, idx) => (
                                        <button
                                            key={idx}
                                            onClick={() => handleButtonClick(opt)}
                                            className={`px-4 py-2 border rounded-lg transition-colors ${
                                                selectedValues.includes(opt)
                                                    ? 'bg-blue-500 text-white border-blue-500'
                                                    : 'hover:bg-gray-50 border-gray-300'
                                            }`}
                                        >
                                            {opt}
                                        </button>
                                    ))}
                                </div>
                            );
                        }

                        return (
                            <div className="space-y-2">
                                {field.options.map((opt, idx) => (
                                    <label key={idx} className="flex items-center gap-2 cursor-pointer">
                                        <input
                                            type={field.allowMultiple ? "checkbox" : "radio"}
                                            name={field.id}
                                            className="rounded"
                                        />
                                        <span>{opt}</span>
                                    </label>
                                ))}
                            </div>
                        );


                    case "rating":
                        return (
                            <div className="flex gap-1">
                                {[1, 2, 3, 4, 5].map((star) => (
                                    <button key={star} className="text-2xl text-gray-300 hover:text-yellow-400 transition-colors">
                                        ‚≠ê
                                    </button>
                                ))}
                            </div>
                        );

                    case "slider":
                        return (
                            <div className="space-y-2">
                                <input
                                    type="range"
                                    min={field.sliderMin || 0}
                                    max={field.sliderMax || 100}
                                    className="w-full"
                                />
                                <div className="flex justify-between text-sm text-gray-500">
                                    <span>{field.sliderMin || 0}</span>
                                    <span>{field.sliderMax || 100}</span>
                                </div>
                            </div>
                        );

                    case "lat_long":
                        return (
                            <div className="space-y-3">
                                <div className="grid grid-cols-2 gap-3">
                                    <div>
                                        <label className="block text-sm text-gray-600 mb-1">‡∏•‡∏∞‡∏ï‡∏¥‡∏à‡∏π‡∏î</label>
                                        <input
                                            type="number"
                                            step="any"
                                            className="w-full border rounded px-3 py-2"
                                            placeholder="13.7563"
                                            value={field.currentLat || ""}
                                            readOnly
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm text-gray-600 mb-1">‡∏•‡∏≠‡∏á‡∏à‡∏¥‡∏à‡∏π‡∏î</label>
                                        <input
                                            type="number"
                                            step="any"
                                            className="w-full border rounded px-3 py-2"
                                            placeholder="100.5018"
                                            value={field.currentLng || ""}
                                            readOnly
                                        />
                                    </div>
                                </div>
                                <button
                                    onClick={() => {
                                        if (navigator.geolocation) {
                                            navigator.geolocation.getCurrentPosition((position) => {
                                                console.log('Location:', position.coords.latitude, position.coords.longitude);
                                                alert(`‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:\n‡∏•‡∏∞‡∏ï‡∏¥‡∏à‡∏π‡∏î: ${position.coords.latitude}\n‡∏•‡∏≠‡∏á‡∏à‡∏¥‡∏à‡∏π‡∏î: ${position.coords.longitude}`);
                                            }, (error) => {
                                                alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏î‡πâ: ' + error.message);
                                            });
                                        } else {
                                            alert('‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Geolocation');
                                        }
                                    }}
                                    className="w-full flex items-center justify-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"
                                >
                                    üìç ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
                                </button>
                            </div>
                        );

                    case "province":
                        return (
                            <select className="w-full border rounded px-3 py-2">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</option>
                                {THAI_PROVINCES.map((province, idx) => (
                                    <option key={idx} value={province}>{province}</option>
                                ))}
                            </select>
                        );

                    case "factory":
                        return (
                            <div className="flex flex-wrap gap-2">
                                {FACTORY_OPTIONS.map((factory, idx) => (
                                    <button
                                        key={idx}
                                        onClick={() => handleButtonClick(factory)}
                                        className={`px-4 py-2 border rounded-lg transition-colors ${
                                            selectedValues.includes(factory)
                                                ? 'bg-green-500 text-white border-green-500'
                                                : 'hover:bg-gray-50 border-gray-300'
                                        }`}
                                    >
                                        {factory}
                                    </button>
                                ))}
                            </div>
                        );

                    default:
                        return <input className="w-full border rounded px-3 py-2" placeholder="‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ô‡∏µ‡πâ" />;
                }
            };

            return (
                <div className="mt-3 p-4 bg-gray-50 rounded-lg border">
                    <div className="text-sm font-medium text-gray-600 mb-2">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•:</div>
                    {renderFieldInput()}
                </div>
            );
        }

        function SubFormBuilder({ subForm, onChange, onDelete, onDuplicate, onMoveUp, onMoveDown, index, total }) {
            const updateField = (i, next) => {
                const fields = [...subForm.fields];
                fields[i] = next;
                onChange({ ...subForm, fields });
            };

            const addField = () => {
                const f = {
                    id: uid('f'),
                    type: 'short_answer',
                    title: '‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà',
                    description: '',
                    required: false,
                    options: []
                };
                onChange({ ...subForm, fields: [...subForm.fields, f] });
            };

            const deleteField = (i) => {
                const fields = subForm.fields.filter((_, idx) => idx !== i);
                onChange({ ...subForm, fields });
            };

            const duplicateField = (i) => {
                const f = { ...subForm.fields[i], id: uid('f'), title: subForm.fields[i].title + ' (‡∏™‡∏≥‡πÄ‡∏ô‡∏≤)' };
                onChange({
                    ...subForm,
                    fields: [...subForm.fields.slice(0, i + 1), f, ...subForm.fields.slice(i + 1)]
                });
            };

            const moveField = (i, dir) => {
                const fields = [...subForm.fields];
                const j = i + dir;
                if (j < 0 || j >= fields.length) return;
                [fields[i], fields[j]] = [fields[j], fields[i]];
                onChange({ ...subForm, fields });
            };

            return (
                <div className="border-2 border-dashed border-gray-300 rounded-lg p-4 bg-gray-50 mb-4">
                    <div className="flex justify-between items-center mb-3">
                        <div className="flex-1">
                            <input
                                value={subForm.title || ""}
                                onChange={(e) => onChange({ ...subForm, title: e.target.value })}
                                placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏¢‡πà‡∏≠‡∏¢"
                                className="text-lg font-semibold w-full mb-1 bg-transparent focus:outline-none focus:bg-white focus:border focus:border-blue-500 rounded px-2 py-1"
                            />
                            <input
                                value={subForm.description || ""}
                                onChange={(e) => onChange({ ...subForm, description: e.target.value })}
                                placeholder="‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏¢‡πà‡∏≠‡∏¢"
                                className="text-sm w-full text-gray-500 bg-transparent focus:outline-none focus:bg-white focus:border focus:border-blue-500 rounded px-2 py-1"
                            />
                        </div>
                        <div className="flex flex-col gap-2 ml-4">
                            <button
                                onClick={onDuplicate}
                                className="px-3 py-1 bg-gray-100 rounded hover:bg-gray-200 transition-colors text-sm"
                            >
                                ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å
                            </button>
                            <button
                                onClick={onDelete}
                                className="px-3 py-1 bg-red-50 text-red-600 rounded hover:bg-red-100 transition-colors text-sm"
                            >
                                ‡∏•‡∏ö
                            </button>
                            <div className="flex flex-col gap-1">
                                <button
                                    onClick={onMoveUp}
                                    disabled={index === 0}
                                    className="px-2 py-1 border rounded disabled:opacity-40 hover:bg-gray-50 transition-colors text-sm"
                                >
                                    ‚Üë
                                </button>
                                <button
                                    onClick={onMoveDown}
                                    disabled={index === total - 1}
                                    className="px-2 py-1 border rounded disabled:opacity-40 hover:bg-gray-50 transition-colors text-sm"
                                >
                                    ‚Üì
                                </button>
                            </div>
                        </div>
                    </div>

                    <div className="mb-3">
                        {subForm.fields.map((f, i) => (
                            <FieldEditor
                                key={f.id}
                                field={f}
                                index={i}
                                total={subForm.fields.length}
                                onChange={(next) => updateField(i, next)}
                                onDelete={() => deleteField(i)}
                                onDuplicate={() => duplicateField(i)}
                                onMoveUp={() => moveField(i, -1)}
                                onMoveDown={() => moveField(i, 1)}
                            />
                        ))}
                    </div>

                    <div className="flex gap-2">
                        <button
                            onClick={addField}
                            className="px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors font-medium"
                        >
                            + ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°
                        </button>
                    </div>
                </div>
            );
        }

        function FieldEditor({ field, onChange, onDelete, onDuplicate, onMoveUp, onMoveDown, index, total }) {
            const handleFieldTypeChange = (newType) => {
                let updatedField = { ...field, type: newType };

                if (newType === "multiple_choice") {
                    if (!updatedField.options || updatedField.options.length === 0) {
                        updatedField.options = ["‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 1", "‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 2"];
                    }
                    updatedField.displayStyle = updatedField.displayStyle || "radio";
                    updatedField.allowMultiple = updatedField.allowMultiple || false;
                }

                if (newType === "slider") {
                    updatedField.sliderMin = updatedField.sliderMin || 0;
                    updatedField.sliderMax = updatedField.sliderMax || 100;
                }

                onChange(updatedField);
            };

            const requiresOptions = ["multiple_choice"].includes(field.type);

            return (
                <div className="border rounded-lg p-4 bg-white shadow-sm mb-4">
                    <div className="flex justify-between items-start">
                        <div className="flex-1 mr-4">
                            <input
                                className="text-lg font-medium w-full mb-2 border-b pb-1 focus:outline-none focus:border-blue-500"
                                value={field.title || ""}
                                onChange={(e) => onChange({ ...field, title: e.target.value })}
                                placeholder="‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°"
                            />

                            <input
                                className="text-sm w-full mb-3 text-gray-500 focus:outline-none"
                                value={field.description || ""}
                                onChange={(e) => onChange({ ...field, description: e.target.value })}
                                placeholder="‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)"
                            />

                            <div className="flex flex-wrap gap-3 items-center mb-3">
                                <select
                                    value={field.type}
                                    onChange={(e) => handleFieldTypeChange(e.target.value)}
                                    className="border rounded px-3 py-2"
                                >
                                    {FIELD_TYPES.map((t) => (
                                        <option key={t} value={t}>
                                            {t.replace(/_/g, " ")}
                                        </option>
                                    ))}
                                </select>

                                <label className="flex items-center gap-2 text-sm">
                                    <input
                                        type="checkbox"
                                        checked={field.required || false}
                                        onChange={(e) => onChange({ ...field, required: e.target.checked })}
                                        className="rounded"
                                    />
                                    ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏ï‡∏≠‡∏ö
                                </label>

                                <label className="flex items-center gap-2 text-sm">
                                    <input
                                        type="checkbox"
                                        checked={field.showInSubmissionTable || false}
                                        onChange={(e) => onChange({ ...field, showInSubmissionTable: e.target.checked })}
                                        className="rounded"
                                    />
                                    ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á Submission
                                </label>

                                <label className="flex items-center gap-2 text-sm">
                                    <input
                                        type="checkbox"
                                        checked={field.sendToTelegram || false}
                                        onChange={(e) => onChange({ ...field, sendToTelegram: e.target.checked })}
                                        className="rounded"
                                    />
                                    ‡∏™‡πà‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô Telegram
                                </label>
                            </div>

                            {field.type === "multiple_choice" && (
                                <div className="space-y-3 mb-3">
                                    <div className="flex gap-3">
                                        <select
                                            value={field.displayStyle || "radio"}
                                            onChange={(e) => onChange({ ...field, displayStyle: e.target.value })}
                                            className="border rounded px-3 py-1 text-sm"
                                        >
                                            {MULTIPLE_CHOICE_DISPLAY_OPTIONS.map((option) => (
                                                <option key={option.value} value={option.value}>
                                                    {option.label}
                                                </option>
                                            ))}
                                        </select>

                                        <label className="flex items-center gap-2 text-sm">
                                            <input
                                                type="checkbox"
                                                checked={field.allowMultiple || false}
                                                onChange={(e) => onChange({ ...field, allowMultiple: e.target.checked })}
                                                className="rounded"
                                            />
                                            ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
                                        </label>
                                    </div>
                                </div>
                            )}

                            {field.type === "slider" && (
                                <div className="grid grid-cols-2 gap-3 mb-3">
                                    <div>
                                        <label className="block text-sm text-gray-600 mb-1">‡∏Ñ‡πà‡∏≤‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î</label>
                                        <input
                                            type="number"
                                            value={field.sliderMin || 0}
                                            onChange={(e) => onChange({ ...field, sliderMin: parseInt(e.target.value) || 0 })}
                                            className="w-full border rounded px-3 py-1 text-sm"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm text-gray-600 mb-1">‡∏Ñ‡πà‡∏≤‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</label>
                                        <input
                                            type="number"
                                            value={field.sliderMax || 100}
                                            onChange={(e) => onChange({ ...field, sliderMax: parseInt(e.target.value) || 100 })}
                                            className="w-full border rounded px-3 py-1 text-sm"
                                        />
                                    </div>
                                </div>
                            )}

                            {requiresOptions && (
                                <div className="mt-3">
                                    <div className="text-sm text-gray-600 mb-2">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</div>
                                    {field.options?.map((opt, i) => (
                                        <div key={i} className="flex gap-2 items-center mb-2">
                                            <input
                                                value={opt || ""}
                                                onChange={(e) => {
                                                    const opts = [...(field.options || [])];
                                                    opts[i] = e.target.value;
                                                    onChange({ ...field, options: opts });
                                                }}
                                                className="flex-1 border px-3 py-2 rounded focus:outline-none focus:border-blue-500"
                                                placeholder={`‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ${i + 1}`}
                                            />
                                            <button
                                                onClick={() => {
                                                    const opts = (field.options || []).filter((_, idx) => idx !== i);
                                                    onChange({ ...field, options: opts });
                                                }}
                                                className="px-3 py-2 bg-red-50 text-red-600 rounded hover:bg-red-100 transition-colors"
                                            >
                                                ‚úï
                                            </button>
                                        </div>
                                    ))}
                                    <button
                                        onClick={() => onChange({
                                            ...field,
                                            options: [...(field.options || []), `‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ${((field.options || []).length + 1)}`]
                                        })}
                                        className="text-sm px-3 py-2 border rounded hover:bg-gray-50 transition-colors"
                                    >
                                        + ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
                                    </button>
                                </div>
                            )}

                            <FieldPreview field={field} />
                        </div>

                        <div className="flex flex-col gap-2">
                            <button
                                onClick={onDuplicate}
                                className="px-3 py-2 bg-gray-100 rounded hover:bg-gray-200 transition-colors text-sm"
                            >
                                ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å
                            </button>
                            <button
                                onClick={onDelete}
                                className="px-3 py-2 bg-red-50 text-red-600 rounded hover:bg-red-100 transition-colors text-sm"
                            >
                                ‡∏•‡∏ö
                            </button>
                            <div className="flex flex-col gap-1">
                                <button
                                    onClick={onMoveUp}
                                    disabled={index === 0}
                                    className="px-2 py-1 border rounded disabled:opacity-40 hover:bg-gray-50 transition-colors text-sm"
                                >
                                    ‚Üë
                                </button>
                                <button
                                    onClick={onMoveDown}
                                    disabled={index === total - 1}
                                    className="px-2 py-1 border rounded disabled:opacity-40 hover:bg-gray-50 transition-colors text-sm"
                                >
                                    ‚Üì
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        function EnhancedFormBuilder() {
            const [title, setTitle] = useState('‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÉ‡∏´‡∏°‡πà');
            const [description, setDescription] = useState('‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ü‡∏≠‡∏£‡πå‡∏°');

            const [fields, setFields] = useState([
                {
                    id: uid('f'),
                    type: 'short_answer',
                    title: '‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•',
                    description: '',
                    required: true,
                    options: []
                }
            ]);

            const [subForms, setSubForms] = useState([]);

            const [preview, setPreview] = useState(false);

            // Form settings state
            const [formSettings, setFormSettings] = useState({
                telegramEnabled: false,
                telegramBotToken: '',
                telegramGroupId: '',
                autoDocumentNumber: false,
                documentPrefix: 'DOC',
                documentSuffix: 'year',
                yearFormat: 'buddhist',
                documentFormat: 'prefix_number_year'
            });

            const addField = () => {
                setFields([...fields, {
                    id: uid('f'),
                    type: 'short_answer',
                    title: '‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà',
                    description: '',
                    required: false,
                    options: []
                }]);
            };

            const updateField = (i, next) => {
                // Check submission table limit
                if (next.showInSubmissionTable && !fields[i].showInSubmissionTable) {
                    const currentSubmissionCount = fields.filter(f => f.showInSubmissionTable).length;
                    if (currentSubmissionCount >= 5) {
                        alert('‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á Submission ‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5 ‡∏ü‡∏¥‡∏•‡∏î‡πå');
                        return;
                    }
                }

                const arr = [...fields];
                arr[i] = next;
                setFields(arr);
            };

            const deleteField = (i) => {
                setFields(fields.filter((_, idx) => idx !== i));
            };

            const duplicateField = (i) => {
                const f = { ...fields[i], id: uid('f'), title: fields[i].title + ' (‡∏™‡∏≥‡πÄ‡∏ô‡∏≤)' };
                setFields([...fields.slice(0, i + 1), f, ...fields.slice(i + 1)]);
            };

            const moveField = (i, dir) => {
                const arr = [...fields];
                const j = i + dir;
                if (j < 0 || j >= arr.length) return;
                [arr[i], arr[j]] = [arr[j], arr[i]];
                setFields(arr);
            };

            // Sub form management functions
            const addSubForm = () => {
                setSubForms([...subForms, {
                    id: uid('s'),
                    title: '‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏¢‡πà‡∏≠‡∏¢‡πÉ‡∏´‡∏°‡πà',
                    description: '',
                    fields: []
                }]);
            };

            const updateSubForm = (i, next) => {
                const arr = [...subForms];
                arr[i] = next;
                setSubForms(arr);
            };

            const deleteSubForm = (i) => {
                setSubForms(subForms.filter((_, idx) => idx !== i));
            };

            const duplicateSubForm = (i) => {
                const s = JSON.parse(JSON.stringify(subForms[i]));
                s.id = uid('s');
                s.title += ' (‡∏™‡∏≥‡πÄ‡∏ô‡∏≤)';
                setSubForms([...subForms.slice(0, i + 1), s, ...subForms.slice(i + 1)]);
            };

            const moveSubForm = (i, dir) => {
                const arr = [...subForms];
                const j = i + dir;
                if (j < 0 || j >= arr.length) return;
                [arr[i], arr[j]] = [arr[j], arr[i]];
                setSubForms(arr);
            };

            return (
                <div className="min-h-screen bg-gray-100 p-6">
                    <div className="max-w-4xl mx-auto">
                        <div className="mb-6 flex items-center justify-between">
                            <div className="flex-1">
                                <input
                                    value={title}
                                    onChange={(e) => setTitle(e.target.value)}
                                    className="text-3xl font-bold w-full mb-2 focus:outline-none bg-transparent border-b-2 border-transparent hover:border-gray-300 focus:border-blue-500 transition-colors"
                                    placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ü‡∏≠‡∏£‡πå‡∏°"
                                />
                                <input
                                    value={description}
                                    onChange={(e) => setDescription(e.target.value)}
                                    className="text-lg w-full text-gray-600 focus:outline-none bg-transparent"
                                    placeholder="‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ü‡∏≠‡∏£‡πå‡∏°"
                                />
                            </div>
                            <div className="flex gap-3 ml-6">
                                <button
                                    onClick={() => setPreview(p => !p)}
                                    className={`px-6 py-3 rounded-lg transition-colors font-medium ${
                                        preview
                                            ? 'bg-blue-500 text-white hover:bg-blue-600'
                                            : 'bg-white border border-gray-300 hover:bg-gray-50'
                                    }`}
                                >
                                    {preview ? '‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç' : 'üëÅÔ∏è ‡∏î‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á'}
                                </button>
                            </div>
                        </div>

                        {!preview && (
                            <>
                                <div className="mb-6">
                                    {fields.map((f, i) => (
                                        <FieldEditor
                                            key={f.id}
                                            field={f}
                                            index={i}
                                            total={fields.length}
                                            onChange={(next) => updateField(i, next)}
                                            onDelete={() => deleteField(i)}
                                            onDuplicate={() => duplicateField(i)}
                                            onMoveUp={() => moveField(i, -1)}
                                            onMoveDown={() => moveField(i, 1)}
                                        />
                                    ))}
                                </div>

                                <div className="mb-6">
                                    <button
                                        onClick={addField}
                                        className="px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors font-medium"
                                    >
                                        + ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°
                                    </button>
                                </div>

                                <div className="mb-6">
                                    <div className="mb-4">
                                        <h3 className="text-xl font-semibold text-gray-800 mb-2">‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏¢‡πà‡∏≠‡∏¢</h3>
                                        <p className="text-sm text-gray-600">‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏¢‡πà‡∏≠‡∏¢‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏¢‡∏Å‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏´‡∏•‡∏±‡∏Å ‡πÅ‡∏•‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏£‡∏≠‡∏Å‡πÅ‡∏¢‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏´‡∏≤‡∏Å‡πÑ‡∏î‡πâ</p>
                                    </div>

                                    {subForms.map((s, i) => (
                                        <SubFormBuilder
                                            key={s.id}
                                            subForm={s}
                                            index={i}
                                            total={subForms.length}
                                            onChange={(next) => updateSubForm(i, next)}
                                            onDelete={() => deleteSubForm(i)}
                                            onDuplicate={() => duplicateSubForm(i)}
                                            onMoveUp={() => moveSubForm(i, -1)}
                                            onMoveDown={() => moveSubForm(i, 1)}
                                        />
                                    ))}

                                    <button
                                        onClick={addSubForm}
                                        className="px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors font-medium"
                                    >
                                        + ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏¢‡πà‡∏≠‡∏¢
                                    </button>
                                </div>

                                <div className="mb-6">
                                    <div className="mb-4">
                                        <h3 className="text-xl font-semibold text-gray-800 mb-2">‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ü‡∏≠‡∏£‡πå‡∏°</h3>
                                        <p className="text-sm text-gray-600">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
                                    </div>

                                    <div className="bg-white p-6 rounded-lg border space-y-4">
                                        <div className="space-y-3">
                                            <label className="flex items-center gap-2">
                                                <input
                                                    type="checkbox"
                                                    checked={formSettings.telegramEnabled}
                                                    onChange={(e) => setFormSettings({...formSettings, telegramEnabled: e.target.checked})}
                                                    className="rounded"
                                                />
                                                <span className="font-medium">‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏õ Telegram</span>
                                            </label>

                                            {formSettings.telegramEnabled && (
                                                <div className="ml-6 space-y-3 pl-4 border-l-2 border-blue-200">
                                                    <div>
                                                        <label className="block text-sm font-medium text-gray-700 mb-1">
                                                            Telegram Bot Token
                                                        </label>
                                                        <input
                                                            type="text"
                                                            value={formSettings.telegramBotToken}
                                                            onChange={(e) => setFormSettings({...formSettings, telegramBotToken: e.target.value})}
                                                            placeholder="1234567890:ABCdefGHijklMNopqRSTuvwxYZ"
                                                            className="w-full border rounded px-3 py-2 text-sm"
                                                        />
                                                    </div>
                                                    <div>
                                                        <label className="block text-sm font-medium text-gray-700 mb-1">
                                                            Telegram Group ID
                                                        </label>
                                                        <input
                                                            type="text"
                                                            value={formSettings.telegramGroupId}
                                                            onChange={(e) => setFormSettings({...formSettings, telegramGroupId: e.target.value})}
                                                            placeholder="-1001234567890"
                                                            className="w-full border rounded px-3 py-2 text-sm"
                                                        />
                                                    </div>
                                                </div>
                                            )}
                                        </div>

                                        <hr className="border-gray-200" />

                                        <div className="space-y-3">
                                            <label className="flex items-center gap-2">
                                                <input
                                                    type="checkbox"
                                                    checked={formSettings.autoDocumentNumber}
                                                    onChange={(e) => setFormSettings({...formSettings, autoDocumentNumber: e.target.checked})}
                                                    className="rounded"
                                                />
                                                <span className="font-medium">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</span>
                                            </label>

                                            {formSettings.autoDocumentNumber && (
                                                <div className="ml-6 space-y-3 pl-4 border-l-2 border-green-200">
                                                    <div>
                                                        <label className="block text-sm font-medium text-gray-700 mb-1">
                                                            ‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ (Prefix)
                                                        </label>
                                                        <input
                                                            type="text"
                                                            value={formSettings.documentPrefix}
                                                            onChange={(e) => setFormSettings({...formSettings, documentPrefix: e.target.value})}
                                                            placeholder="TS-ISO"
                                                            className="border rounded px-3 py-2 text-sm w-32"
                                                        />
                                                    </div>

                                                    <div>
                                                        <label className="block text-sm font-medium text-gray-700 mb-1">
                                                            ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏õ‡∏µ
                                                        </label>
                                                        <select
                                                            value={formSettings.yearFormat}
                                                            onChange={(e) => setFormSettings({...formSettings, yearFormat: e.target.value})}
                                                            className="border rounded px-3 py-2 text-sm"
                                                        >
                                                            <option value="buddhist">‡∏û.‡∏®. (2568)</option>
                                                            <option value="christian">‡∏Ñ.‡∏®. (2025)</option>
                                                        </select>
                                                    </div>

                                                    <div>
                                                        <label className="block text-sm font-medium text-gray-700 mb-1">
                                                            ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
                                                        </label>
                                                        <select
                                                            value={formSettings.documentFormat}
                                                            onChange={(e) => setFormSettings({...formSettings, documentFormat: e.target.value})}
                                                            className="border rounded px-3 py-2 text-sm w-64"
                                                        >
                                                            <option value="prefix_number_year">Prefix-Number/Year (TS-ISO-0995/2025)</option>
                                                            <option value="prefix_year_number">Prefix-Year/Number (TS-ISO-2025/0995)</option>
                                                        </select>
                                                    </div>

                                                    <div className="bg-gray-50 p-3 rounded border text-sm">
                                                        <div className="font-medium text-gray-700 mb-1">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£:</div>
                                                        <div className="text-blue-600 font-mono">
                                                            {formSettings.documentFormat === 'prefix_number_year'
                                                                ? `${formSettings.documentPrefix}-0001/${formSettings.yearFormat === 'buddhist' ? '2568' : '2025'}`
                                                                : `${formSettings.documentPrefix}-${formSettings.yearFormat === 'buddhist' ? '2568' : '2025'}/0001`
                                                            }
                                                        </div>
                                                    </div>
                                                </div>
                                            )}
                                        </div>

                                        <hr className="border-gray-200" />

                                        <div className="bg-blue-50 p-4 rounded border border-blue-200">
                                            <h4 className="font-medium text-blue-800 mb-2">‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</h4>
                                            <div className="text-sm text-blue-700 space-y-1">
                                                <div>‚Ä¢ ‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô Submission Table: {fields.filter(f => f.showInSubmissionTable).length}/5</div>
                                                <div>‚Ä¢ ‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô Telegram: {fields.filter(f => f.sendToTelegram).length}</div>
                                                <div>‚Ä¢ ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô Telegram: {formSettings.telegramEnabled ? '‡πÄ‡∏õ‡∏¥‡∏î' : '‡∏õ‡∏¥‡∏î'}</div>
                                                <div>‚Ä¢ ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥: {formSettings.autoDocumentNumber ? '‡πÄ‡∏õ‡∏¥‡∏î' : '‡∏õ‡∏¥‡∏î'}</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </>
                        )}

                        {preview && (
                            <div className="bg-white p-8 rounded-lg shadow-lg">
                                <div className="mb-8">
                                    <h1 className="text-3xl font-bold text-gray-900 mb-2">{title}</h1>
                                    <p className="text-lg text-gray-600">{description}</p>
                                </div>

                                <form className="space-y-6">
                                    {fields.map((f) => (
                                        <div key={f.id} className="p-6 border rounded-lg bg-gray-50">
                                            <div className="mb-4">
                                                <label className="block text-lg font-medium text-gray-900 mb-1">
                                                    {f.title}{f.required ? ' *' : ''}
                                                </label>
                                                {f.description && (
                                                    <p className="text-sm text-gray-600">{f.description}</p>
                                                )}
                                            </div>

                                            <FieldPreview field={f} />
                                        </div>
                                    ))}

                                    {subForms.map((s) => (
                                        <details key={s.id} className="border rounded-lg p-6 bg-blue-50 border-blue-200">
                                            <summary className="font-semibold text-lg cursor-pointer text-blue-800 hover:text-blue-600">
                                                {s.title || '‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏¢‡πà‡∏≠‡∏¢'} - {s.description}
                                            </summary>
                                            <div className="mt-4 space-y-4">
                                                {s.fields.map((f) => (
                                                    <div key={f.id} className="p-4 border rounded-lg bg-white">
                                                        <div className="mb-4">
                                                            <label className="block text-lg font-medium text-gray-900 mb-1">
                                                                {f.title}{f.required ? ' *' : ''}
                                                            </label>
                                                            {f.description && (
                                                                <p className="text-sm text-gray-600">{f.description}</p>
                                                            )}
                                                        </div>

                                                        <FieldPreview field={f} />
                                                    </div>
                                                ))}
                                                {s.fields.length === 0 && (
                                                    <p className="text-gray-500 italic">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏¢‡πà‡∏≠‡∏¢‡∏ô‡∏µ‡πâ</p>
                                                )}
                                            </div>
                                        </details>
                                    ))}

                                    <div className="pt-6">
                                        <button
                                            type="submit"
                                            className="px-8 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors font-medium"
                                            onClick={(e) => {
                                                e.preventDefault();
                                                alert('‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß! (‡∏ô‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö)');
                                            }}
                                        >
                                            ‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
                                        </button>
                                    </div>
                                </form>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<EnhancedFormBuilder />, document.getElementById('root'));
    </script>
</body>
</html>